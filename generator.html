<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æç¤ºè¯ - éšæœºç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="app-nav">
        <a href="index.html" class="nav-link">ğŸ“š é£æ ¼é¢„è®¾åº“</a>
        <a href="generator.html" class="nav-link active">ğŸ² éšæœºç”Ÿæˆå™¨</a>
    </nav>

    <div class="page-container">
        <div class="controls-header">
            <button class="ctrl-btn" onclick="toggleAll(true)">å…¨å¼€</button>
            <button class="ctrl-btn" onclick="toggleAll(false)">å…¨å…³</button>
            <button class="ctrl-btn" onclick="resetLocks()">é‡ç½®é”</button>
            <button class="ctrl-btn" style="color: #8b5cf6; border-color: #8b5cf6;" onclick="openSettings()">âš™ï¸ AIè®¾ç½®</button>
            <button class="ctrl-btn danger" onclick="handleSignOut()">ğŸšª ç™»å‡º</button>
        </div>

        <div id="cardGrid" class="gen-grid"></div>
    </div>

    <div class="fixed-bar">
        <div class="bar-row">
            <input type="text" class="bar-input" id="aiInput" placeholder="âœ¨ AI è”æƒ³: è¾“å…¥ä¸­æ–‡åœºæ™¯æè¿° (å¦‚: é›¨å¤œçš„ä¸œäº¬è¡—å¤´)...">
            <button class="bar-btn" style="background:#8b5cf6" onclick="callAI('scene')">ğŸ§  è”æƒ³</button>
            <button class="bar-btn" style="background:#4b5563" onclick="callAI('translate')">ğŸª„ ç¿»è¯‘</button>
        </div>

        <div class="bar-row">
            <input type="text" class="bar-input" id="loraInput" placeholder="LoRA / èµ·æ‰‹å¼ (å§‹ç»ˆä¿ç•™)" oninput="buildFinalString()">
            <input type="text" class="bar-input" id="negInput" placeholder="ğŸš« è´Ÿé¢ Prompt (Negative)" style="border-color:#ef4444; color:#fca5a5; background:#2a1515;">
        </div>

        <div class="bar-row">
            <button class="bar-btn" onclick="rollAll()">ğŸ² ROLL (Space)</button>
            <textarea id="finalOutput" class="final-text" placeholder="æœ€ç»ˆç”Ÿæˆçš„ Prompt..."></textarea>
            <button class="bar-btn" style="background:#10b981" onclick="copyFinal()">ğŸ“‹ å¤åˆ¶</button>
        </div>
    </div>

    <div id="toast" class="toast">Copied!</div>
    
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h3 style="color:white; margin-top:0">âš™ï¸ AI API è®¾ç½®</h3>
            <label style="color:#94a3b8">API Key</label>
            <input type="password" id="apiKey" placeholder="sk-xxxx">
            <label style="color:#94a3b8">Base URL</label>
            <input type="text" id="apiBase" value="https://api.siliconflow.cn/v1">
            <label style="color:#94a3b8">Model</label>
            <input type="text" id="apiModel" value="Qwen/Qwen2.5-7B-Instruct">
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button class="ctrl-btn" onclick="closeSettings()">å–æ¶ˆ</button>
                <button class="ctrl-btn" style="background:#8b5cf6; color:white; border:none;" onclick="saveSettings()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script src="data/init.js"></script>
    <script src="data/styles.js"></script>
    <script src="data/writing.js"></script>
    <script src="data/driver.js"></script>
    <script src="data/docs.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="database.js"></script>
    <script src="script.js"></script> 
    
    <script>
        // ä¸“é—¨ä¸ºç™»å‡ºåŠŸèƒ½åˆå§‹åŒ–å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ä¸å†²çªçš„å˜é‡å
        const SUPABASE_URL = 'https://mjmpvgyyeqalcocuizwb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbXB2Z3l5ZXFhbGNvY3VpendiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzU1MzcsImV4cCI6MjA4MTQ1MTUzN30.M8S9zElBiuvVaDWTeiwRN0YeTsDqrlfzNVvCzX8-9sQ';
        const LOGIN_PATH = '/login.html';

        const supabaseSignOutClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function handleSignOut() {
            if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                const { error } = await supabaseSignOutClient.auth.signOut();
                if (error) {
                    alert('ç™»å‡ºå¤±è´¥ï¼š' + error.message);
                } else {
                    // ç™»å‡ºæˆåŠŸåé‡å®šå‘åˆ°ç™»å½•é¡µ
                    window.location.href = LOGIN_PATH;
                }
            }
        }
    </script>
</body>
</html>