<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - è®¿é—®å—é™å†…å®¹</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* é’ˆå¯¹ç™»å½•é¡µé¢çš„é¢å¤–æ ·å¼ï¼Œä½¿å…¶å±…ä¸­æ˜¾ç¤º */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* å€Ÿé‰´æ‚¨ç°æœ‰ modal çš„æ ·å¼ä½œä¸ºç™»å½•å¡ç‰‡ */
        .login-card {
            background-color: var(--card-bg); /* æ¥è‡ª style.css */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
        }

        .login-card h2 {
            color: var(--accent-color); /* æ¥è‡ª style.css */
            margin-top: 0;
            text-align: center;
            margin-bottom: 25px;
        }

        .login-card label {
            display: block;
            color: var(--text-sub); /* æ¥è‡ª style.css */
            margin-bottom: 8px;
            font-size: 0.95rem;
            margin-top: 15px;
        }

        .login-card input[type="email"],
        .login-card input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color); /* æ¥è‡ª style.css */
            background-color: var(--bg-color); /* æ¥è‡ª style.css */
            color: var(--text-main); /* æ¥è‡ª style.css */
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        
        /* é”™è¯¯/æç¤ºä¿¡æ¯æ ·å¼ */
        #message {
            color: #ef4444; /* extreme_danger é¢œè‰² */
            margin-top: 15px;
            text-align: center;
            font-size: 0.9rem;
            min-height: 1.2em;
        }

        .auth-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
    </style>
</head>
<body>

    <div class="login-container">
        <div class="login-card">
            <h2>ğŸ” ç™»å½•è®¿é—®</h2>
            
            <form id="authForm">
                <label for="email">é‚®ç®± (Email)</label>
                <input type="email" id="email" required placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">

                <label for="password">å¯†ç  (Password)</label>
                <input type="password" id="password" required placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç ">
                
                <p id="message"></p>

                <div class="auth-actions">
                    <button type="submit" class="ctrl-btn" style="flex: 1; background:#6366f1; color:white; border:none;">
                        ç™»å½•
                    </button>
                    <button type="button" id="signUpBtn" class="ctrl-btn" style="flex: 1; color:#3b82f6; border-color:#3b82f6; background:none;">
                        æ³¨å†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ===========================================
        // 1. Supabase é…ç½®
        // ===========================================
        const SUPABASE_URL = 'https://mjmpvgyyeqalcocuizwb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1qbXB2Z3l5ZXFhbGNvY3VpendiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4NzU1MzcsImV4cCI6MjA4MTQ1MTUzN30.M8S9zElBiuvVaDWTeiwRN0YeTsDqrlfzNVvCzX8-9sQ';
        const REDIRECT_TO = '/index.html'; // æˆåŠŸç™»å½•åè·³è½¬çš„ä¸»é¡µé¢
        
        // ä¿®æ­£ï¼šç›´æ¥è°ƒç”¨å…¨å±€çš„ createClientï¼Œå¹¶ç”¨æ–°å˜é‡åå­˜å‚¨ç»“æœï¼Œé¿å…ä¸å…¨å±€ Supabase å˜é‡å†²çª
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // å…ƒç´ å¼•ç”¨
        const authForm = document.getElementById('authForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const messageEl = document.getElementById('message');
        const signUpBtn = document.getElementById('signUpBtn');

        // ===========================================
        // 2. æ£€æŸ¥ä¼šè¯çŠ¶æ€ï¼ˆé˜²æ­¢å·²ç™»å½•ç”¨æˆ·é‡å¤çœ‹åˆ°ç™»å½•é¡µï¼‰
        // ===========================================
        async function checkSession() {
            // ä½¿ç”¨ä¿®æ­£åçš„å®¢æˆ·ç«¯å˜é‡
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                // å¦‚æœç”¨æˆ·å·²ç»æœ‰ä¼šè¯ï¼Œç›´æ¥è·³è½¬åˆ°ä¸»é¡µ
                window.location.href = REDIRECT_TO;
            }
        }
        checkSession();

        // ===========================================
        // 3. ç™»å½•å¤„ç†å‡½æ•°
        // ===========================================
        async function handleSignIn(event) {
            event.preventDefault();
            messageEl.textContent = 'æ­£åœ¨ç™»å½•...';
            
            const email = emailInput.value;
            const password = passwordInput.value;

            // ä½¿ç”¨ä¿®æ­£åçš„å®¢æˆ·ç«¯å˜é‡
            const { error } = await supabaseClient.auth.signInWithPassword({
                email,
                password,
            });

            if (error) {
                messageEl.textContent = `ç™»å½•å¤±è´¥: ${error.message}`;
            } else {
                messageEl.textContent = 'ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...';
                // ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä¸»é¡µ
                window.location.href = REDIRECT_TO;
            }
        }

        // ===========================================
        // 4. æ³¨å†Œå¤„ç†å‡½æ•°
        // ===========================================
        async function handleSignUp() {
            messageEl.textContent = 'æ­£åœ¨æ³¨å†Œ...';

            const email = emailInput.value;
            const password = passwordInput.value;

            if (!email || !password) {
                messageEl.textContent = 'è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ï¼';
                return;
            }

            // ä½¿ç”¨ä¿®æ­£åçš„å®¢æˆ·ç«¯å˜é‡
            const { error } = await supabaseClient.auth.signUp({
                email,
                password,
            });

            if (error) {
                messageEl.textContent = `æ³¨å†Œå¤±è´¥: ${error.message}`;
            } else {
                messageEl.textContent = 'æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±è¿›è¡Œç¡®è®¤ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨è¯¥è´¦å·ç™»å½•äº†ã€‚';
                // æ¸…ç©ºå¯†ç æ¡†
                passwordInput.value = '';
            }
        }

        // ===========================================
        // 5. ç»‘å®šäº‹ä»¶
        // ===========================================
        authForm.addEventListener('submit', handleSignIn);
        signUpBtn.addEventListener('click', handleSignUp);

    </script>
</body>
</html>